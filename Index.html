<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Per√π 2026 ‚Äî Diario di Viaggio</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Barlow:wght@300;400;500;600&family=Barlow+Condensed:wght@600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
:root {
  --gold: #E8A830;
  --rust: #C4501A;
  --jungle: #2D6A4F;
  --sky: #1B4F72;
  --sand: #F5E6C8;
  --dark: #1A1208;
  --text: #2C1810;
  --light: #FDFAF4;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Barlow', sans-serif;
  background: var(--dark);
  color: var(--light);
  min-height: 100vh;
}

/* ===== NAV ===== */
nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
  background: rgba(26,18,8,0.95);
  backdrop-filter: blur(10px);
  border-bottom: 2px solid var(--gold);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 2rem; height: 60px;
}
.nav-logo {
  font-family: 'Playfair Display', serif;
  font-size: 1.2rem; color: var(--gold);
  letter-spacing: 0.05em;
}
.nav-links { display: flex; gap: 0.5rem; align-items: center; }
.nav-btn {
  background: none; border: none; cursor: pointer;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.75rem; font-weight: 600; letter-spacing: 0.1em;
  text-transform: uppercase; color: rgba(255,255,255,0.6);
  padding: 0.4rem 0.8rem; border-radius: 3px;
  transition: all 0.2s;
}
.nav-btn:hover, .nav-btn.active {
  color: var(--gold); background: rgba(232,168,48,0.15);
}
.nav-todo {
  color: var(--rust) !important;
  border: 1px solid var(--rust);
}
.nav-todo:hover { background: rgba(196,80,26,0.15) !important; color: var(--rust) !important; }

/* ===== PAGES ===== */
.page { display: none; padding-top: 60px; min-height: 100vh; }
.page.active { display: block; }

/* ===== HOME PAGE ===== */
#home {
  background: linear-gradient(135deg, #1A1208 0%, #2D1B0E 50%, #1B2E1A 100%);
}

.hero {
  position: relative; height: 92vh;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
}
.hero-bg {
  position: absolute; inset: 0;
  background-image: none; /* caricata via JS */
  background-size: cover; background-position: center;
  filter: brightness(0.35) saturate(1.2);
}
.hero-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to bottom, transparent 40%, var(--dark) 100%);
}
.hero-content {
  position: relative; text-align: center; padding: 2rem;
  animation: fadeUp 1.2s ease;
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}
.hero-flag { font-size: 4rem; margin-bottom: 1rem; }
.hero-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(3rem, 8vw, 7rem);
  font-weight: 900; line-height: 0.9;
  color: var(--sand);
  text-shadow: 0 4px 30px rgba(0,0,0,0.8);
}
.hero-title span { color: var(--gold); font-style: italic; }
.hero-subtitle {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1.1rem; letter-spacing: 0.3em; text-transform: uppercase;
  color: var(--gold); margin: 1.5rem 0;
}
.hero-dates {
  font-size: 1rem; color: rgba(255,255,255,0.7);
  font-weight: 300; letter-spacing: 0.1em;
}
.hero-scroll {
  position: absolute; bottom: 2rem; left: 50%;
  transform: translateX(-50%);
  animation: bounce 2s infinite;
  color: var(--gold); font-size: 1.5rem;
}
@keyframes bounce {
  0%,100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(8px); }
}

/* Stats strip */
.stats-strip {
  display: grid; grid-template-columns: repeat(4, 1fr);
  background: var(--gold); padding: 1.5rem 3rem; gap: 1rem;
}
.stat { text-align: center; }
.stat-num {
  font-family: 'Playfair Display', serif;
  font-size: 2.5rem; font-weight: 900;
  color: var(--dark); line-height: 1;
}
.stat-label {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: rgba(26,18,8,0.7); margin-top: 0.3rem;
}

/* Overview section */
.overview {
  padding: 4rem 3rem;
  max-width: 1200px; margin: 0 auto;
}
.section-title {
  font-family: 'Playfair Display', serif;
  font-size: 2.5rem; color: var(--gold);
  margin-bottom: 2rem;
  border-left: 4px solid var(--rust);
  padding-left: 1.5rem;
}

/* Home map */
.home-map-container {
  padding: 2rem 3rem 4rem;
  max-width: 1200px; margin: 0 auto;
}
#home-map {
  width: 100%; height: 500px;
  border-radius: 8px;
  border: 2px solid var(--gold);
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}

/* Journey timeline */
.journey-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem; margin-top: 2rem;
}
.journey-card {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(232,168,48,0.2);
  border-radius: 8px; overflow: hidden;
  cursor: pointer; transition: all 0.3s;
  position: relative;
}
.journey-card:hover {
  border-color: var(--gold);
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(232,168,48,0.2);
}
.journey-card-img {
  width: 100%; height: 120px; object-fit: cover;
  filter: brightness(0.7) saturate(1.1);
  transition: filter 0.3s;
}
.journey-card:hover .journey-card-img { filter: brightness(0.85) saturate(1.3); }
.journey-card-body { padding: 0.8rem; }
.journey-card-day {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--gold);
}
.journey-card-title {
  font-family: 'Playfair Display', serif;
  font-size: 0.95rem; color: var(--sand);
  margin-top: 0.2rem; line-height: 1.2;
}
.journey-card-date {
  font-size: 0.75rem; color: rgba(255,255,255,0.4);
  margin-top: 0.3rem;
}

/* ===== DAY PAGE ===== */
#day-page { background: var(--dark); }

.day-header {
  position: relative; height: 50vh; min-height: 350px;
  display: flex; align-items: flex-end;
  overflow: hidden;
}
.day-header-bg {
  position: absolute; inset: 0;
  background-size: cover; background-position: center;
  filter: brightness(0.4) saturate(1.3);
  transition: background-image 0.5s;
}
.day-header-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, var(--dark) 0%, transparent 60%);
}
.day-header-content {
  position: relative; padding: 2rem 3rem;
  width: 100%;
}
.day-number {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.8rem; letter-spacing: 0.3em; text-transform: uppercase;
  color: var(--gold);
}
.day-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(2rem, 5vw, 4rem);
  font-weight: 900; color: var(--sand);
  line-height: 1; margin: 0.3rem 0;
}
.day-date-str {
  font-size: 0.9rem; color: rgba(255,255,255,0.5);
  font-weight: 300;
}

/* Day nav bar */
.day-nav-bar {
  background: rgba(26,18,8,0.95);
  border-bottom: 1px solid rgba(232,168,48,0.2);
  padding: 0.8rem 2rem;
  display: flex; align-items: center; justify-content: space-between;
  gap: 1rem; overflow-x: auto;
}
.day-nav-scroll { display: flex; gap: 0.4rem; flex: 1; overflow-x: auto; }
.day-nav-scroll::-webkit-scrollbar { height: 2px; }
.day-nav-scroll::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 1px; }
.day-pill {
  flex-shrink: 0;
  background: none; border: 1px solid rgba(232,168,48,0.3);
  border-radius: 20px; padding: 0.3rem 0.8rem;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase;
  color: rgba(255,255,255,0.5); cursor: pointer; transition: all 0.2s;
  white-space: nowrap;
}
.day-pill:hover, .day-pill.active {
  background: var(--gold); border-color: var(--gold);
  color: var(--dark); font-weight: 700;
}
.day-nav-arrows { display: flex; gap: 0.5rem; }
.arrow-btn {
  background: rgba(232,168,48,0.1); border: 1px solid rgba(232,168,48,0.3);
  border-radius: 4px; padding: 0.4rem 0.8rem;
  color: var(--gold); cursor: pointer; font-size: 1rem;
  transition: all 0.2s;
}
.arrow-btn:hover { background: var(--gold); color: var(--dark); }
.arrow-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* Day body */
.day-body {
  max-width: 1200px; margin: 0 auto;
  display: grid; grid-template-columns: 1fr 380px;
  gap: 2rem; padding: 2rem 3rem 4rem;
}
@media (max-width: 900px) {
  .day-body { grid-template-columns: 1fr; }
}

/* Day info box */
.day-info-box {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(232,168,48,0.2);
  border-radius: 8px; padding: 1.2rem;
  margin-bottom: 2rem;
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 0.6rem;
}
.info-item { display: flex; flex-direction: column; gap: 0.1rem; }
.info-label {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.6rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--gold);
}
.info-value { font-size: 0.85rem; color: rgba(255,255,255,0.8); }

/* Stops */
.stops-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.75rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--gold); margin-bottom: 1rem;
  display: flex; align-items: center; gap: 0.5rem;
}
.stops-title::after {
  content: ''; flex: 1; height: 1px; background: rgba(232,168,48,0.2);
}
.stop-card {
  display: grid; grid-template-columns: 80px 1fr;
  gap: 1rem; margin-bottom: 1.5rem;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 8px; overflow: hidden;
  transition: border-color 0.2s;
}
.stop-card:hover { border-color: rgba(232,168,48,0.3); }
.stop-img {
  width: 80px; height: 100%;
  min-height: 90px;
  object-fit: cover;
  filter: saturate(1.1);
}
.stop-body { padding: 0.8rem 0.8rem 0.8rem 0; }
.stop-time {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.65rem; letter-spacing: 0.15em; color: var(--gold);
}
.stop-name {
  font-family: 'Playfair Display', serif;
  font-size: 1rem; color: var(--sand);
  margin: 0.2rem 0;
}
.stop-desc { font-size: 0.8rem; color: rgba(255,255,255,0.55); line-height: 1.5; }

/* Day map */
.day-map-sticky { position: sticky; top: 80px; }
#day-map {
  width: 100%; height: 380px;
  border-radius: 8px;
  border: 2px solid rgba(232,168,48,0.4);
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
  margin-bottom: 1.5rem;
}
.tips-box {
  background: rgba(45,106,79,0.15);
  border: 1px solid rgba(45,106,79,0.4);
  border-radius: 8px; padding: 1rem;
}
.tips-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: #52B788; margin-bottom: 0.8rem;
}
.tip-item {
  font-size: 0.78rem; color: rgba(255,255,255,0.65);
  padding: 0.4rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);
  line-height: 1.4;
}
.tip-item:last-child { border-bottom: none; }
.tip-emoji { margin-right: 0.4rem; }

/* ===== TODO PAGE ===== */
#todo-page { background: var(--dark); padding: 2rem 3rem 4rem; }
.todo-header {
  text-align: center; padding: 3rem 0 2rem;
  border-bottom: 1px solid rgba(232,168,48,0.2);
  margin-bottom: 3rem;
}
.todo-header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 3rem; color: var(--gold);
}
.todo-header p {
  color: rgba(255,255,255,0.5); margin-top: 0.5rem;
  font-weight: 300;
}

.todo-grid {
  max-width: 1200px; margin: 0 auto;
  display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1.5rem;
}
.todo-category {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 10px; overflow: hidden;
}
.todo-cat-header {
  padding: 1rem 1.2rem;
  display: flex; align-items: center; gap: 0.8rem;
}
.todo-cat-icon { font-size: 1.5rem; }
.todo-cat-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1rem; letter-spacing: 0.1em; text-transform: uppercase;
  font-weight: 700;
}
.todo-items { padding: 0 1.2rem 1.2rem; }
.todo-item {
  display: flex; align-items: flex-start; gap: 0.8rem;
  padding: 0.7rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  cursor: pointer;
}
.todo-item:last-child { border-bottom: none; }
.todo-check {
  width: 18px; height: 18px; flex-shrink: 0;
  border: 2px solid rgba(255,255,255,0.2);
  border-radius: 3px; margin-top: 1px;
  transition: all 0.2s; display: flex; align-items: center; justify-content: center;
  font-size: 0.7rem;
}
.todo-item.done .todo-check {
  background: var(--jungle); border-color: var(--jungle);
}
.todo-item.done .todo-check::after { content: '‚úì'; color: white; font-weight: bold; }
.todo-item-content { flex: 1; }
.todo-item-main {
  font-size: 0.85rem; color: rgba(255,255,255,0.85);
  line-height: 1.4;
}
.todo-item.done .todo-item-main {
  text-decoration: line-through; color: rgba(255,255,255,0.35);
}
.todo-item-sub {
  font-size: 0.72rem; color: rgba(255,255,255,0.35);
  margin-top: 0.2rem;
}
.todo-urgency {
  font-size: 0.6rem; font-weight: 700; letter-spacing: 0.1em;
  text-transform: uppercase; padding: 0.15rem 0.5rem;
  border-radius: 10px; flex-shrink: 0; margin-top: 2px;
}
.urgency-red { background: rgba(196,80,26,0.3); color: #E8734A; }
.urgency-orange { background: rgba(232,168,48,0.2); color: var(--gold); }
.urgency-green { background: rgba(45,106,79,0.3); color: #52B788; }

/* Progress */
.todo-progress {
  max-width: 1200px; margin: 0 auto 2rem;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(232,168,48,0.2);
  border-radius: 10px; padding: 1.2rem 1.5rem;
  display: flex; align-items: center; gap: 1.5rem;
}
.progress-bar-wrap {
  flex: 1; background: rgba(255,255,255,0.08);
  border-radius: 10px; height: 8px; overflow: hidden;
}
.progress-bar {
  height: 100%; background: linear-gradient(90deg, var(--jungle), var(--gold));
  border-radius: 10px; transition: width 0.4s ease;
}
.progress-text {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.85rem; color: var(--gold); white-space: nowrap;
}

/* Leaflet overrides */
.leaflet-container { background: #1A2A1A !important; }
.leaflet-tile-pane { filter: brightness(0.8) saturate(0.7); }
.leaflet-popup-content-wrapper {
  background: #1A1208 !important;
  border: 1px solid #E8A830 !important;
  border-radius: 6px !important;
  color: #FDFAF4 !important;
  font-family: 'Barlow', sans-serif !important;
  box-shadow: 0 8px 30px rgba(0,0,0,0.6) !important;
}
.leaflet-popup-tip { background: #1A1208 !important; }
.leaflet-popup-content { font-size: 0.82rem; line-height: 1.5; }
.custom-marker {
  background: var(--gold); border: 2px solid var(--dark);
  width: 10px; height: 10px; border-radius: 50%;
  box-shadow: 0 0 6px rgba(232,168,48,0.6);
}

/* Responsive */
@media (max-width: 768px) {
  .stats-strip { grid-template-columns: repeat(2,1fr); }
  .day-body { padding: 1.5rem; }
  nav { padding: 0 1rem; }
  .nav-links { gap: 0.2rem; }
  .nav-btn { padding: 0.3rem 0.5rem; font-size: 0.65rem; }
  #todo-page { padding: 1.5rem; }
  .todo-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav>
  <div class="nav-logo">üáµüá™ Per√π 2026</div>
  <div class="nav-links">
    <button class="nav-btn active" onclick="showPage('home')">Home</button>
    <button class="nav-btn" id="day-nav-btn" onclick="showPage('day', currentDay)">Giorni</button>
    <button class="nav-btn nav-todo" onclick="showPage('todo')">‚úì Todo</button>
  </div>
</nav>

<!-- HOME PAGE -->
<div id="home" class="page active">
  <div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="hero-flag">üáµüá™</div>
      <h1 class="hero-title">Per√π<br><span>2026</span></h1>
      <div class="hero-subtitle">Un viaggio attraverso 4 ecosistemi</div>
      <div class="hero-dates">28 Agosto ‚Äî 10 Settembre 2026 ¬∑ Zurigo ‚Üí Lima ‚Üí Amazzonia ‚Üí Zurigo</div>
    </div>
    <div class="hero-scroll">‚Üì</div>
  </div>

  <div class="stats-strip">
    <div class="stat"><div class="stat-num">14</div><div class="stat-label">Giorni</div></div>
    <div class="stat"><div class="stat-num">4</div><div class="stat-label">Ecosistemi</div></div>
    <div class="stat"><div class="stat-num">5200</div><div class="stat-label">Metri quota max</div></div>
    <div class="stat"><div class="stat-num">7</div><div class="stat-label">Destinazioni</div></div>
  </div>

  <div class="home-map-container">
    <div class="section-title">Il Percorso</div>
    <div id="home-map"></div>
  </div>

  <div class="overview">
    <div class="section-title">Il Viaggio Giorno per Giorno</div>
    <div class="journey-grid" id="journey-grid"></div>
  </div>
</div>

<!-- DAY PAGE -->
<div id="day-page" class="page">
  <div class="day-header">
    <div class="day-header-bg" id="day-header-bg"></div>
    <div class="day-header-overlay"></div>
    <div class="day-header-content">
      <div class="day-number" id="day-number-label"></div>
      <h1 class="day-title" id="day-title"></h1>
      <div class="day-date-str" id="day-date-str"></div>
    </div>
  </div>

  <div class="day-nav-bar">
    <button class="arrow-btn" id="prev-btn" onclick="navigateDay(-1)">‚Üê</button>
    <div class="day-nav-scroll" id="day-pills"></div>
    <button class="arrow-btn" id="next-btn" onclick="navigateDay(1)">‚Üí</button>
  </div>

  <div class="day-body">
    <div>
      <div class="day-info-box" id="day-info-box"></div>
      <div class="stops-title">Tappe della giornata</div>
      <div id="stops-container"></div>
    </div>
    <div class="day-map-sticky">
      <div id="day-map"></div>
      <div class="tips-box" id="tips-box"></div>
    </div>
  </div>
</div>

<!-- TODO PAGE -->
<div id="todo-page" class="page">
  <div class="todo-header">
    <h1>‚úÖ Lista Prenotazioni</h1>
    <p>Tutto quello da fare prima di partire da Zurigo</p>
  </div>
  <div class="todo-progress" id="todo-progress">
    <div class="progress-bar-wrap"><div class="progress-bar" id="progress-bar" style="width:0%"></div></div>
    <div class="progress-text" id="progress-text">0 / 0 completati</div>
  </div>
  <div class="todo-grid" id="todo-grid"></div>
</div>

<script>
// ===== DATA =====
const DAYS = [
  {
    id: 1, date: "28 Ago", fullDate: "Gioved√¨ 28 Agosto 2026",
    title: "Lima", subtitle: "Arrivo e prime scoperte",
    wiki: "Miraflores_District,_Lima",
    lat: -12.1211, lng: -77.0282,
    info: [
      {label:"Trasporto", value:"‚úàÔ∏è Zurigo ‚Üí Lima"},
      {label:"Hotel", value:"Miraflores"},
      {label:"Quota", value:"154m s.l.m."},
      {label:"Nota", value:"Sveglia domani 04:30!"}
    ],
    stops: [
      {time:"06:30", name:"Aeroporto Jorge Ch√°vez", desc:"Atterraggio da Zurigo. Taxi verso Miraflores ~45min.", wiki:"Jorge_Ch√°vez_International_Airport", lat:-12.0219, lng:-77.1143, transfer:true},
      {time:"09:30", name:"Plaza Mayor & Centro Storico", desc:"Cattedrale, Palazzo del Governo. Architettura coloniale UNESCO.", wiki:"Historic_Centre_of_Lima", lat:-12.0464, lng:-77.0297},
      {time:"10:30", name:"Monastero di San Francisco", desc:"Visita guidata obbligatoria. Le catacombe con 70.000 resti umani.", wiki:"Convent_of_San_Francisco,_Lima", lat:-12.0453, lng:-77.0286},
      {time:"13:00", name:"Gastronomia a Miraflores", desc:"Lima √® la capitale gastronomica del Sud America. Ceviche, tiradito, causa.", wiki:"Peruvian_cuisine", lat:-12.1211, lng:-77.0282},
      {time:"15:00", name:"Parco dell'Amore", desc:"Lungomare con vista sul Pacifico. Parapendii, scogliere, El Beso.", wiki:"Miraflores_District,_Lima", lat:-12.1296, lng:-77.0318},
      {time:"17:30", name:"Quartiere di Barranco", desc:"Boh√©mien, street art, Ponte dei Sospiri, ottimi ristoranti.", wiki:"Barranco_District", lat:-12.1527, lng:-77.0200},
    ],
    tips: ["üí∞ Cambia valuta solo in banche o cambiavalute autorizzati","üì± Scarica Google Maps offline","üîí Usa solo taxi Uber o autorizzati","üò¥ Resisti fino alle 21:00 per il jet lag"],
    mapCenter: [-12.0800, -77.0600], mapZoom: 12
  },
  {
    id: 2, date: "29 Ago", fullDate: "Venerd√¨ 29 Agosto 2026",
    title: "Paracas + Huacachina", subtitle: "Isole Ballestas e dune infinite",
    wiki: "Huacachina",
    lat: -14.0879, lng: -75.9576,
    info: [
      {label:"Trasporto", value:"üöå Bus Lima‚ÜíParacas (4h)"},
      {label:"Hotel", value:"Senoma Hotel, Huacachina"},
      {label:"Nota", value:"Sveglia 04:30!"},
      {label:"Clima", value:"Caldo e soleggiato ~26¬∞C"}
    ],
    stops: [
      {time:"04:30", name:"Partenza da Lima", desc:"Bus dalla stazione verso Paracas. Cruz del Sur o Oltursa.", wiki:"Lima", lat:-12.1211, lng:-77.0282, transfer:true},
      {time:"09:00", name:"Porto di Paracas", desc:"Imbarco per le Isole Ballestas. Tour ~2 ore.", wiki:"Paracas,_Ica", lat:-13.8398, lng:-76.2469},
      {time:"10:00", name:"Isole Ballestas", desc:"Mini Gal√°pagos: pinguini di Humboldt, leoni marini, pellicani, cormorani.", wiki:"Ballestas_Islands", lat:-13.7722, lng:-76.3981},
      {time:"13:00", name:"Bus verso Huacachina", desc:"45 min da Paracas a Ica, poi taxi fino all'oasi.", wiki:"Ica,_Peru", lat:-14.0879, lng:-75.9576},
      {time:"16:00", name:"Dune Buggy & Sandboard", desc:"L'attivit√† pi√π spettacolare. Dune alte 100m, tramonto sui deserti.", wiki:"Huacachina", lat:-14.0879, lng:-75.9576},
      {time:"18:30", name:"Cena al Senoma Hotel", desc:"Ristorante con vista sull'oasi. Cocktail e tramonto sulle dune.", wiki:"Oasis", lat:-14.0900, lng:-75.9580},
    ],
    tips: ["üß• Giacca a vento per la barca (freddo in mare)","üì∏ Busta antipioggia per la fotocamera sulle dune","üíß Acqua abbondante nelle dune","üèä Costume per la piscina in hotel"],
    mapCenter: [-14.0, -76.0], mapZoom: 9
  },
  {
    id: 3, date: "30 Ago", fullDate: "Sabato 30 Agosto 2026",
    title: "Huacachina ‚Üí Arequipa", subtitle: "Lima di transito, Ciudad Blanca",
    wiki: "Arequipa",
    lat: -16.4090, lng: -71.5375,
    info: [
      {label:"Trasporto", value:"üöå Bus Huacachina‚ÜíLima + ‚úàÔ∏è Lima‚ÜíArequipa"},
      {label:"Hotel", value:"Centro storico Arequipa"},
      {label:"Quota", value:"2.335m s.l.m."},
      {label:"Nota", value:"Prima serata tranquilla!"}
    ],
    stops: [
      {time:"09:00", name:"Partenza da Huacachina", desc:"Check-out Senoma Hotel. Bus verso Ica, poi Ica‚ÜíLima (~4h sulla Panamericana Sur).", wiki:"Huacachina", lat:-14.0879, lng:-75.9576, transfer:true},
      {time:"13:00", name:"Lima ‚Äî Recupero bagagli", desc:"Taxi/Uber verso hotel Miraflores per recuperare zaini grandi lasciati il 28/08.", wiki:"Lima", lat:-12.1211, lng:-77.0282, transfer:true},
      {time:"16:00", name:"Volo Lima ‚Üí Arequipa ‚úàÔ∏è", desc:"~1h15. Vista spettacolare sulle Ande. Siediti dal lato destro!", wiki:"Rodr√≠guez_Ball√≥n_International_Airport", lat:-12.0219, lng:-77.1143, transfer:true},
      {time:"17:30", name:"Arrivo ad Arequipa", desc:"Taxi dal Rodr√≠guez Ball√≥n verso centro storico (~20 min). Sistemazione in hotel.", wiki:"Historic_Centre_of_Arequipa", lat:-16.3988, lng:-71.5369},
      {time:"18:30", name:"Plaza de Armas di Arequipa", desc:"Una delle pi√π belle del Per√π. Cattedrale in sillar bianco, El Misti sullo sfondo.", wiki:"Historic_Centre_of_Arequipa", lat:-16.3988, lng:-71.5369},
      {time:"19:30", name:"Cena Arequipe√±a", desc:"Rocoto relleno, adobo arequipe√±o, chupe de camarones. Chicha di Gast√≥n Acurio.", wiki:"Arequipa", lat:-16.4090, lng:-71.5375},
    ],
    tips: ["üèîÔ∏è Sei a 2.335m ‚Äî bevi 3L acqua","üåø Mate di coca ad ogni pasto","üç∫ Niente alcol stasera","üöï Solo Uber o taxi di hotel"],
    mapCenter: [-16.4090, -71.5375], mapZoom: 13
  },
  {
    id: 4, date: "31 Ago", fullDate: "Domenica 31 Agosto 2026",
    title: "Arequipa", subtitle: "Giornata libera ‚Äî Santa Catalina e Yanahuara",
    wiki: "Arequipa",
    lat: -16.4090, lng: -71.5375,
    info: [
      {label:"Programma", value:"üèôÔ∏è Giornata libera ad Arequipa"},
      {label:"Hotel", value:"Arequipa centro storico"},
      {label:"Quota", value:"2.335m s.l.m. ‚Äî seconda notte"},
      {label:"Nota", value:"Giornata leggera ‚Äî acclimatamento!"}
    ],
    stops: [
      {time:"09:00", name:"Monastero di Santa Catalina", desc:"Una citt√† nella citt√†. Vicoli colorati, chiostri, celle delle monache. 2-3 ore facilmente.", wiki:"Convent_of_San_Francisco,_Lima", lat:-16.3958, lng:-71.5368},
      {time:"11:30", name:"Plaza de Armas", desc:"Caff√® sotto i portici. Cattedrale in sillar bianco con El Misti (5.822m) sullo sfondo.", wiki:"Historic_Centre_of_Arequipa", lat:-16.3988, lng:-71.5369},
      {time:"13:00", name:"Pranzo al Mercato San Camilo", desc:"Il mercato pi√π autentico di Arequipa. Cucina locale economica e buonissima.", wiki:"Peruvian_cuisine", lat:-16.4020, lng:-71.5380},
      {time:"14:30", name:"Barrio de San L√°zaro", desc:"Il quartiere pi√π antico. Vicoli stretti in sillar bianco, case coloniali, calma totale.", wiki:"Arequipa", lat:-16.3940, lng:-71.5350},
      {time:"16:30", name:"Mirador di Yanahuara üåã", desc:"Il belvedere pi√π bello. Vista panoramica sui tre vulcani: El Misti, Chachani, Pichu Pichu.", wiki:"El_Misti", lat:-16.3880, lng:-71.5510},
      {time:"19:30", name:"Cena ad Arequipa", desc:"Zig Zag Restaurant ‚Äî grill su pietra vulcanica. Ottima carne di alpaca.", wiki:"Arequipa", lat:-16.4090, lng:-71.5375},
    ],
    tips: ["üèîÔ∏è Acclimatamento: bevi 2L acqua, evita alcol","üåø Mate di coca consigliato","üõçÔ∏è Ottima per acquistare alpaca di qualit√†","üíä Sorojchi Pills in farmacia se mal di testa"],
    mapCenter: [-16.4000, -71.5380], mapZoom: 14
  },
  {
    id: 5, date: "1 Set", fullDate: "Marted√¨ 1 Settembre 2026",
    title: "Canyon del Colca", subtitle: "I condor delle Ande ‚Äî Giardino Tours",
    wiki: "Colca_Canyon",
    lat: -15.6300, lng: -71.9500,
    info: [
      {label:"Operatore", value:"Giardino Tours ‚Äî giardinotours.com"},
      {label:"Sveglia", value:"03:00 ‚ö†Ô∏è"},
      {label:"Quota max", value:"4.910m (Passo Patapampa)"},
      {label:"Include", value:"Guida+pranzo+colazione"}
    ],
    stops: [
      {time:"03:30", name:"Partenza da Arequipa", desc:"Bus del tour parte dall'hotel. ~3.5h attraverso le Ande.", wiki:"Arequipa", lat:-16.4090, lng:-71.5375, transfer:true},
      {time:"05:00", name:"Passo Patapampa (4.910m)", desc:"Il punto pi√π alto del viaggio. Puna andina, lama, alpaca. Freddo glaciale 0-5¬∞C.", wiki:"Alpaca", lat:-15.8000, lng:-71.9800},
      {time:"07:00", name:"Chivay ‚Äî Colazione", desc:"Paese principale della valle. Colazione inclusa. Ticket canyon 70 PEN.", wiki:"Colca_Canyon", lat:-15.5295, lng:-71.4630},
      {time:"09:00", name:"Mirador Cruz del C√≥ndor ü¶Ö", desc:"Il momento clou! Canyon pi√π profondo del mondo (3.270m). Condor in volo maestoso.", wiki:"Cruz_del_C√≥ndor", lat:-15.6300, lng:-71.9500},
      {time:"11:00", name:"Soste panoramiche al canyon", desc:"Rientro con soste ai belvedere. Terrazze preinca, villaggi andini, greggi di lama.", wiki:"Llama", lat:-15.5800, lng:-71.8000},
      {time:"13:00", name:"Pranzo incluso ‚Äî Rientro", desc:"Cucina andina: alpaca, trucha, quinoa, papa a la huanca√≠na. Bus verso Arequipa.", wiki:"Peruvian_cuisine", lat:-15.6000, lng:-71.7000},
      {time:"16:00", name:"Rientro ad Arequipa", desc:"Doccia e riposo meritato. Cena leggera ‚Äî domani volo per Cusco.", wiki:"Arequipa", lat:-16.4090, lng:-71.5375},
    ],
    tips: ["üß• Strati obbligatori ‚Äî al passo 0¬∞C","üåø Foglie di coca contro l'altitudine","üíß Almeno 1.5L acqua","üì∏ Teleobiettivo per i condor"],
    mapCenter: [-15.8, -71.8], mapZoom: 10
  },
  {
    id: 6, date: "2 Set", fullDate: "Mercoled√¨ 2 Settembre 2026",
    title: "Arequipa ‚Üí Cusco", subtitle: "La capitale dell'impero Inca",
    wiki: "Cusco",
    lat: -13.5170, lng: -71.9785,
    info: [
      {label:"Trasporto", value:"‚úàÔ∏è Arequipa‚ÜíCusco (~1h)"},
      {label:"Hotel", value:"Centro storico Cusco ‚ö†Ô∏è STESSO x G9"},
      {label:"Quota", value:"3.400m (+1.065m da Arequipa)"},
      {label:"Zaino", value:"Lascia grande in deposito hotel"}
    ],
    stops: [
      {time:"08:30", name:"Volo Arequipa ‚Üí Cusco", desc:"~1h. Avvicinamento spettacolare tra le Ande.", wiki:"Alejandro_Velasco_Astete_International_Airport", lat:-16.3411, lng:-71.5718, transfer:true},
      {time:"10:00", name:"Check-in + Riposo obbligatorio", desc:"Prima cosa: riposarsi 1-2h. Il corpo deve adattarsi a 3.400m.", wiki:"Altitude_sickness", lat:-13.5170, lng:-71.9785},
      {time:"12:30", name:"Mercato San Pedro", desc:"Cucina locale economica, succhi di frutta, prodotti andini.", wiki:"Mercado_de_San_Pedro,_Cusco", lat:-13.5233, lng:-71.9826},
      {time:"14:30", name:"Qorikancha ‚Äî Tempio del Sole", desc:"Il tempio pi√π importante dell'impero Inca. Architettura inca + coloniale.", wiki:"Qorikancha", lat:-13.5178, lng:-71.9757},
      {time:"17:00", name:"Plaza de Armas di Cusco", desc:"La pi√π famosa del Per√π. Cattedrale e Compa√±√≠a de Jes√∫s su fondamenta inca.", wiki:"Plaza_de_Armas_(Cusco)", lat:-13.5170, lng:-71.9785},
      {time:"18:30", name:"Cena a Cusco", desc:"Chicha di Gast√≥n Acurio, Cicciolina o Marcelo Batata. Cucina andina.", wiki:"Peruvian_cuisine", lat:-13.5160, lng:-71.9780},
    ],
    tips: ["üèîÔ∏è Cusco 3.400m ‚Äî cammina lentissimo","üç∫ Zero alcol stanotte","üíä Sorojchi Pills se mal di testa","üéí Lascia zaino grande in hotel deposito"],
    mapCenter: [-13.5170, -71.9785], mapZoom: 14
  },
  {
    id: 7, date: "3 Set", fullDate: "Gioved√¨ 3 Settembre 2026",
    title: "Valle Sacra", subtitle: "Pisac, Maras, Moray, Ollantaytambo",
    wiki: "Sacred_Valley",
    lat: -13.2570, lng: -72.2647,
    info: [
      {label:"Tour", value:"GetYourGuide ‚Äî Ollantaytambo drop-off"},
      {label:"Treno", value:"16:37 Ollantay‚ÜíAguas Calientes"},
      {label:"Pernotta", value:"Aguas Calientes üå°Ô∏è"},
      {label:"Zaino", value:"Solo piccolo ‚Äî grande in deposito Cusco"}
    ],
    stops: [
      {time:"08:00", name:"Partenza da Cusco", desc:"Tour raccoglie in hotel. Comunica drop-off a Ollantaytambo.", wiki:"Cusco", lat:-13.5170, lng:-71.9785, transfer:true},
      {time:"09:00", name:"Pisac ‚Äî Parco Archeologico", desc:"Cresta montana con terrazzamenti inca spettacolari. Vista sulla Valle.", wiki:"Pisac", lat:-13.4167, lng:-71.8508},
      {time:"11:30", name:"Mercato di Pisac", desc:"Tessuti, ceramiche, gioielli. Contratta sempre!", wiki:"Andean_textiles", lat:-13.4258, lng:-71.8519},
      {time:"13:30", name:"Saline di Maras", desc:"Migliaia di vasche di sale terrazzate. Pre-inca, ancora in uso.", wiki:"Salinas_de_Maras", lat:-13.3394, lng:-72.1569},
      {time:"14:30", name:"Moray ‚Äî Laboratorio Inca", desc:"Cerchi concentrici con microclimi diversi. Geometria unica al mondo.", wiki:"Moray_(Inca_ruin)", lat:-13.3378, lng:-72.1919},
      {time:"15:30", name:"Ollantaytambo ‚Äî Fortezza", desc:"Fortezza inca pi√π imponente della Valle. Vicoli inca originali.", wiki:"Ollantaytambo", lat:-13.2570, lng:-72.2647},
      {time:"16:37", name:"Treno ‚Üí Aguas Calientes", desc:"PeruRail o Inca Rail. Vistadome. Canyon del Urubamba.", wiki:"Urubamba_River", lat:-13.2576, lng:-72.2645},
      {time:"18:30", name:"Terme di Aguas Calientes ‚ô®Ô∏è", desc:"Piscine termali naturali aperte fino alle 22:00. Deserte la sera.", wiki:"Aguas_Calientes,_Peru", lat:-13.1534, lng:-72.5255},
    ],
    tips: ["üéüÔ∏è Boleto Tur√≠stico 130 PEN (include Pisac,Moray,Ollantay)","üöÇ Treno 16:37 ‚Äî ultima chance decente","üßÇ Maras: porta cash (20 PEN)","‚ô®Ô∏è Costume e asciugamano per le terme"],
    mapCenter: [-13.35, -72.0], mapZoom: 10
  },
  {
    id: 8, date: "4 Set", fullDate: "Venerd√¨ 4 Settembre 2026",
    title: "Machu Picchu", subtitle: "La Meraviglia del Mondo",
    wiki: "Machu_Picchu",
    lat: -13.1631, lng: -72.5450,
    info: [
      {label:"Bus", value:"05:30 da Aguas Calientes"},
      {label:"Quota", value:"2.430m (pi√π basso di Cusco!)"},
      {label:"Biglietti", value:"‚ö†Ô∏è Prenota mesi prima"},
      {label:"Zaino", value:"Max 20L dentro il sito"}
    ],
    stops: [
      {time:"05:30", name:"Bus da Aguas Calientes", desc:"Ogni 10 min dalle 05:30. Acquista biglietti in anticipo.", wiki:"Aguas_Calientes,_Peru", lat:-13.1534, lng:-72.5255},
      {time:"06:00", name:"Machu Picchu ‚Äî Ingresso", desc:"La Meraviglia del Mondo. Guida consigliata ‚Äî le pietre diventano storia.", wiki:"Machu_Picchu", lat:-13.1631, lng:-72.5450},
      {time:"06:30", name:"Terrazzo del Sole", desc:"La vista iconica con Huayna Picchu sullo sfondo. La foto del viaggio.", wiki:"Huayna_Picchu", lat:-13.1626, lng:-72.5451},
      {time:"08:00", name:"Tempio del Sole + Intihuatana", desc:"Architettura inca perfetta. L'orologio solare inca ancora intatto.", wiki:"Intihuatana", lat:-13.1639, lng:-72.5459},
      {time:"12:30", name:"Inti Punku ‚Äî Porta del Sole", desc:"~1h a/r. Vista panoramica su Machu Picchu dall'alto. Inclusa nel biglietto.", wiki:"Inti_Punku", lat:-13.1750, lng:-72.5282},
      {time:"14:00", name:"Rientro ad Aguas Calientes", desc:"Bus di discesa. Pranzo ‚Äî trota del fiume Urubamba freschissima.", wiki:"Urubamba_River", lat:-13.1534, lng:-72.5255},
      {time:"16:00", name:"Terme ‚ô®Ô∏è ‚Äî Secondo giorno", desc:"Premio dopo Machu Picchu. Piscine calde, giungla, silenzio.", wiki:"Hot_spring", lat:-13.1520, lng:-72.5265},
    ],
    tips: ["üì∏ Luce migliore 06:00-09:00","ü¶ô Non nutrire i lama","üçΩÔ∏è No cibo nelle aree monumentali","üåßÔ∏è La nebbia si dissolve ‚Äî non preoccuparti"],
    mapCenter: [-13.1631, -72.5450], mapZoom: 14
  },
  {
    id: 9, date: "5 Set", fullDate: "Sabato 5 Settembre 2026",
    title: "‚Üí Ollantaytambo ‚Üí Cusco", subtitle: "Rientro alla capitale inca",
    wiki: "Ollantaytambo",
    lat: -13.2570, lng: -72.2647,
    info: [
      {label:"Treno", value:"07:00 Aguas Cal.‚ÜíOllantay"},
      {label:"Hotel", value:"Stesso di Cusco ‚Äî ritiro zaino grande"},
      {label:"Quota", value:"Ritorno a 3.400m"},
      {label:"Stasera", value:"Letto presto ‚Äî domani 03:00!"}
    ],
    stops: [
      {time:"07:00", name:"Treno ‚Üí Ollantaytambo", desc:"Mattutino. PeruRail descrive questo slot: colazione e passeggiata tranquilla.", wiki:"PeruRail", lat:-13.1534, lng:-72.5255, transfer:true},
      {time:"08:45", name:"Ollantaytambo ‚Äî Mattina tranquilla", desc:"Vicoli inca quasi deserti. Hearts Caf√© per colazione. Canali originali inca.", wiki:"Ollantaytambo", lat:-13.2570, lng:-72.2647},
      {time:"11:30", name:"Taxi ‚Üí Cusco", desc:"~1.5h panoramica. Taxi ~80-100 PEN o colectivo ~20 PEN.", wiki:"Sacred_Valley", lat:-13.2576, lng:-72.2645, transfer:true},
      {time:"13:00", name:"Cusco ‚Äî Ritiro zaino e riposo", desc:"Stesso hotel del Giorno 6. Ritiro zaino grande. Acqua e mate di coca.", wiki:"Mate_de_coca", lat:-13.5170, lng:-71.9785, transfer:true},
      {time:"14:00", name:"San Blas o Sacsayhuam√°n", desc:"Quartiere artigiani, vicoli stretti. O fortezza inca sopra Cusco.", wiki:"Sacsayhuam√°n", lat:-13.5140, lng:-71.9746},
      {time:"19:00", name:"Cena leggera + Letto presto", desc:"Zero alcol. Zaino Rainbow Mountain pronto. Sveglia alle 03:00.", wiki:"Peruvian_cuisine", lat:-13.5170, lng:-71.9785},
    ],
    tips: ["üèîÔ∏è Quota di nuovo ‚Äî bevi acqua","üç∫ Zero alcol ‚Äî domani 5.200m","üéí Prepara zaino: guanti,berretto,crema solare","üíä Sorojchi Pills pronte"],
    mapCenter: [-13.35, -72.1], mapZoom: 10
  },
  {
    id: 10, date: "6 Set", fullDate: "Domenica 6 Settembre 2026",
    title: "Rainbow Mountain", subtitle: "Vinicunca 5.036m",
    wiki: "Vinicunca",
    lat: -13.8702, lng: -71.3030,
    info: [
      {label:"Tour", value:"Rainbow Mountain Travels 4.9‚òÖ"},
      {label:"Sveglia", value:"03:00 ‚ö†Ô∏è"},
      {label:"Quota vetta", value:"5.036m s.l.m."},
      {label:"Include", value:"Colazione+guida+pranzo"}
    ],
    stops: [
      {time:"03:30", name:"Pickup in hotel ‚Äî Cusco", desc:"Buio totale, freddo. Strati subito. Il bus ha mate di coca.", wiki:"Mate_de_coca", lat:-13.5170, lng:-71.9785},
      {time:"06:30", name:"Colazione in villaggio andino", desc:"Uova, pane, mate di coca. Momento autentico prima dell'alba.", wiki:"Andes", lat:-13.7000, lng:-71.5000, transfer:true},
      {time:"07:00", name:"Parcheggio base (4.600m)", desc:"Inizio trekking ~4km a/r, 600m dislivello. O cavallo/moto.", wiki:"Hiking", lat:-13.8702, lng:-71.3030},
      {time:"09:30", name:"Vetta Vinicunca (5.036m) üåà", desc:"Strisce rosse, verdi, gialle, viola. Panorama Ande a 360¬∞. Alpaca libere.", wiki:"Vinicunca", lat:-13.8702, lng:-71.3030},
      {time:"10:00", name:"Red Valley *(opzionale)*", desc:"+30 PEN, 20 min oltre la vetta. Tutta rossa per ossido di ferro. Meno turisti.", wiki:"Iron_oxide", lat:-13.8800, lng:-71.2900},
      {time:"12:00", name:"Pranzo incluso ‚Äî Rientro", desc:"Piatti andini caldi. Poi bus verso Cusco, arrivo ~15:00.", wiki:"Quinoa", lat:-13.7500, lng:-71.4000},
    ],
    tips: ["üß• 0¬∞C in vetta ‚Äî strati termici obbligatori","‚òÄÔ∏è Protezione 50+ ‚Äî sole fortissimo a 5000m","üíä Sorojchi Pills 30min prima del trekking","üêå Cammina LENTISSIMO ‚Äî nessun passo affrettato"],
    mapCenter: [-13.7, -71.5], mapZoom: 10
  },
  {
    id: 11, date: "7 Set", fullDate: "Luned√¨ 7 Settembre 2026",
    title: "‚Üí Amazzonia", subtitle: "Dalla montagna alla giungla",
    wiki: "Tambopata_National_Reserve",
    lat: -12.5934, lng: -69.1891,
    info: [
      {label:"Volo", value:"Cusco‚ÜíPuerto Maldonado (~45min)"},
      {label:"Lodge", value:"Refugio Amazonas o Sandoval Lake"},
      {label:"Clima", value:"~30¬∞C umido"},
      {label:"Nota", value:"Il lodge gestisce tutto il trasfer"}
    ],
    stops: [
      {time:"09:00", name:"Volo Cusco ‚Üí Puerto Maldonado", desc:"~45min. Le Ande cedono alla giungla verde infinita. Spettacolare.", wiki:"Puerto_Maldonado", lat:-13.5357, lng:-71.9387, transfer:true},
      {time:"10:30", name:"Barca sul Madre de Dios üõ∂", desc:"~1.5h di navigazione nella foresta. Gi√† si vedono caimani, uccelli, delfini rosa.", wiki:"Madre_de_Dios_River", lat:-12.5934, lng:-69.1891},
      {time:"12:00", name:"Arrivo al lodge", desc:"Check-in nel bungalow. Pranzo nella sala ristorante aperta sulla foresta.", wiki:"Amazon_rainforest", lat:-12.5934, lng:-69.1891},
      {time:"15:00", name:"Prima escursione guidata ü¶ú", desc:"Introduzione all'ecosistema. Alberi giganti, rane, insetti, primi avvistamenti.", wiki:"Poison_dart_frog", lat:-12.5934, lng:-69.1891},
      {time:"20:30", name:"Safari notturno ü¶é", desc:"Uscita in barca con torce. Caimani dagli occhi brillanti, rane, tarantole.", wiki:"Caiman", lat:-12.5934, lng:-69.1891},
    ],
    tips: ["ü¶ü Repellente DEET 30%+ obbligatorio","üëü Mai infradito in giungla","üì∑ Zoom lungo ‚Äî fauna in cima agli alberi","üíä Consulta medico per profilassi malaria"],
    mapCenter: [-12.5, -69.5], mapZoom: 8
  },
  {
    id: 12, date: "8 Set", fullDate: "Marted√¨ 8 Settembre 2026",
    title: "Amazzonia ‚Äî Macaw & Lontre", subtitle: "Prima giornata intera in giungla",
    wiki: "Scarlet_macaw",
    lat: -12.5934, lng: -69.1891,
    info: [
      {label:"Lodge", value:"Tambopata ‚Äî Madre de Dios"},
      {label:"Clima", value:"~30¬∞C di giorno"},
      {label:"Fauna", value:"Macaw, lontre, caimani"},
      {label:"Ritmo", value:"Alba, riposo, pomeriggio, safari"}
    ],
    stops: [
      {time:"05:30", name:"Alba nella giungla üåÖ", desc:"Coro degli uccelli ‚Äî suono indimenticabile. Uscita breve con naturalista.", wiki:"Amazon_rainforest", lat:-12.5934, lng:-69.1891},
      {time:"09:00", name:"Leccata di Argilla ‚Äî Macaw ü¶ú", desc:"Centinaia di ara coloratissimi sulla parete di argilla. Spettacolo iconico.", wiki:"Scarlet_macaw", lat:-12.5934, lng:-69.1891},
      {time:"11:30", name:"Riposo al lodge", desc:"Amaca, piscina, veranda. Il pomeriggio caldo √® per la fauna nascosta.", wiki:"Hammock", lat:-12.5934, lng:-69.1891},
      {time:"15:00", name:"Lago Ossbow ‚Äî Lontre Giganti ü¶¶", desc:"Canoa in silenzio totale. Lontre giganti, caimani neri, anaconde.", wiki:"Giant_otter", lat:-12.5934, lng:-69.1891},
      {time:"16:30", name:"Canopy Tower üå≥", desc:"Vista 360¬∞ sopra la volta della foresta. Uccelli che vivono solo in cima.", wiki:"Emergent_layer", lat:-12.5934, lng:-69.1891},
      {time:"18:00", name:"Tramonto sul fiume üåÖ", desc:"Barca sul Madre de Dios. Delfini rosa (boto) comuni in questa zona.", wiki:"Amazon_river_dolphin", lat:-12.5934, lng:-69.1891},
    ],
    tips: ["ü§´ Parla sottovoce nelle escursioni","üåßÔ∏è Impermeabile leggero sempre nello zaino","üì± WiFi limitato ‚Äî distacco dalla tecnologia","‚òÄÔ∏è Crema solare anche all'ombra della giungla"],
    mapCenter: [-12.5, -69.5], mapZoom: 9
  },
  {
    id: 13, date: "9 Set", fullDate: "Mercoled√¨ 9 Settembre 2026",
    title: "Amazzonia ‚Äî Piranha & Safari", subtitle: "Ultima sera nella giungla",
    wiki: "Giant_otter",
    lat: -12.5934, lng: -69.1891,
    info: [
      {label:"Lodge", value:"Ultima notte in giungla"},
      {label:"Clima", value:"~30¬∞C, possibili temporali"},
      {label:"Stasera", value:"Prepara zaino per domani"},
      {label:"Mance", value:"$10-20 per i naturalisti"}
    ],
    stops: [
      {time:"09:00", name:"Trekking Etnobotanico üåø", desc:"Piante medicinali e alimentari indigene. La giungla √® una farmacia naturale.", wiki:"Amazon_rainforest", lat:-12.5934, lng:-69.1891},
      {time:"11:00", name:"Comunit√† Indigena *(opzionale)*", desc:"Artigianato, musica tradizionale, medicina della foresta. Contatto autentico.", wiki:"Indigenous_peoples_of_the_Amazon", lat:-12.5934, lng:-69.1891},
      {time:"14:00", name:"Pomeriggio libero al lodge üò¥", desc:"Amaca, lettura, birdwatching dalla veranda. La giungla si gode in silenzio.", wiki:"Birdwatching", lat:-12.5934, lng:-69.1891},
      {time:"16:00", name:"Pesca al Piranha üé£", desc:"Canne rudimentali. I piranha abboccano in minuti. Innocui e divertenti.", wiki:"Piranha", lat:-12.5934, lng:-69.1891},
      {time:"18:00", name:"Ultimo tramonto sul fiume", desc:"Birra o cocktail sul molo. Silenzio assoluto tranne la giungla.", wiki:"Madre_de_Dios_River", lat:-12.5934, lng:-69.1891},
      {time:"21:00", name:"Safari Notturno Finale ü¶é", desc:"Ultima uscita in barca. Occhi brillanti dei caimani nell'oscurit√†.", wiki:"Caiman", lat:-12.5934, lng:-69.1891},
    ],
    tips: ["üéí Prepara zaino stasera ‚Äî domani partenza presto","üí∞ Mance ai naturalisti: $10-20 a persona","üõçÔ∏è Artigianato indigeno in lodge = souvenir etico","üêç Anaconda: sulle rive fangose, al sole"],
    mapCenter: [-12.5, -69.5], mapZoom: 9
  },
  {
    id: 14, date: "10 Set", fullDate: "Gioved√¨ 10 Settembre 2026",
    title: "‚Üí Lima ‚Üí Zurigo", subtitle: "Arrivederci Per√π",
    wiki: "Madre_de_Dios_River",
    lat: -12.0464, lng: -77.0428,
    info: [
      {label:"Trasporto", value:"Barca‚ÜíPuerto Maldonado‚ÜíLima‚ÜíZurigo"},
      {label:"Scalo Lima", value:"Almeno 3h ‚Äî visita Miraflores"},
      {label:"Volo Lima-ZRH", value:"~12-13h"},
      {label:"Arrivo Zurigo", value:"Giorno dopo ‚úàÔ∏è"}
    ],
    stops: [
      {time:"06:00", name:"Barca di rientro ‚Äî Addio giungla üõ∂", desc:"Ultima navigazione. Ascolta il coro mattutino per l'ultima volta.", wiki:"Amazon_river_dolphin", lat:-12.5934, lng:-69.1891},
      {time:"09:00", name:"Volo Puerto Maldonado ‚Üí Lima", desc:"~1.5h. Arrivo Jorge Ch√°vez con scalo.", wiki:"Puerto_Maldonado", lat:-12.6136, lng:-69.2289, transfer:true},
      {time:"12:00", name:"Lima ‚Äî Ultimo pranzo a Miraflores", desc:"Se lo scalo lo permette: ceviche fresco o Central/Maido. Vista Pacifico.", wiki:"Miraflores_District,_Lima", lat:-12.1211, lng:-77.0282},
      {time:"15:00", name:"Volo Lima ‚Üí Zurigo ‚úàÔ∏è", desc:"~12-13h. Fine di un viaggio indimenticabile.", wiki:"Jorge_Ch√°vez_International_Airport", lat:-12.0219, lng:-77.1143},
    ],
    tips: ["‚è∞ Almeno 3h di scalo a Lima","üçΩÔ∏è Ultimo pasto peruviano merita","üíä Prendi i farmaci avanzati nel bagaglio a mano","üì∏ Ultima foto al Pacifico da Miraflores"],
    mapCenter: [-12.08, -77.0], mapZoom: 11
  }
];

const TODO_CATS = [
  {
    icon:"‚úàÔ∏è", title:"Voli Internazionali", color:"#C4501A",
    items:[
      {text:"Volo Zurigo ‚Üí Lima (andata)", sub:"Cerca su Kayak/Skyscanner. SWISS o LATAM. ~12h.", urgency:"red"},
      {text:"Volo Lima ‚Üí Zurigo (ritorno, ~10 Set)", sub:"Stesso booking o separato.", urgency:"red"},
    ]
  },
  {
    icon:"üõ´", title:"Voli Interni Per√π", color:"#E8A830",
    items:[
      {text:"Lima ‚Üí Arequipa (30 Ago mattina)", sub:"LATAM o Sky Airline. ~1h15. 150-250 PEN.", urgency:"orange"},
      {text:"Arequipa ‚Üí Cusco (2 Set mattina)", sub:"LATAM o Sky Airline. ~1h. 150-250 PEN.", urgency:"orange"},
      {text:"Cusco ‚Üí Puerto Maldonado (7 Set)", sub:"LATAM o Sky Airline. ~45min. 150-250 PEN.", urgency:"orange"},
      {text:"Puerto Maldonado ‚Üí Lima (10 Set)", sub:"LATAM o Sky Airline. ~1h30. 150-250 PEN.", urgency:"orange"},
    ]
  },
  {
    icon:"üè®", title:"Hotel", color:"#2D6A4F",
    items:[
      {text:"Hotel Lima ‚Äî Miraflores (28 Ago)", sub:"1 notte. Vicino al Parco dell'Amore.", urgency:"green"},
      {text:"Hotel Huacachina ‚Äî Senoma Hotel (29 Ago)", sub:"1 notte. Adults only, vista dune.", urgency:"green"},
      {text:"Hotel Arequipa centro storico (30 Ago - 1 Set)", sub:"2 notti. Vicino Plaza de Armas.", urgency:"green"},
      {text:"Hotel Cusco centro storico (2-3 Set + 5-6 Set)", sub:"‚ö†Ô∏è STESSO hotel per deposito zaino. 4 notti totali.", urgency:"red"},
      {text:"Hotel Aguas Calientes (3-4 Set)", sub:"2 notti. Vicino stazione treni.", urgency:"orange"},
    ]
  },
  {
    icon:"üöÇ", title:"Treni Machu Picchu", color:"#C4501A",
    items:[
      {text:"Treno Ollantaytambo ‚Üí Aguas Calientes (3 Set, 16:37)", sub:"perurail.com o incarail.com. Vistadome. 80-150 PEN.", urgency:"red"},
      {text:"Treno Aguas Calientes ‚Üí Ollantaytambo (5 Set, ~07:00)", sub:"Stesso sito. Prenota A/R insieme.", urgency:"red"},
    ]
  },
  {
    icon:"üéüÔ∏è", title:"Biglietti & Permessi", color:"#E8A830",
    items:[
      {text:"Biglietti Machu Picchu (4 Set)", sub:"tuboleto.cultura.pe ‚Äî si esauriscono mesi prima! Circuit 2, slot 06:00.", urgency:"red"},
      {text:"Bus Aguas Calientes ‚Üí Machu Picchu (A/R)", sub:"Acquistabile online in anticipo. ~25 PEN.", urgency:"orange"},
      {text:"Boleto Tur√≠stico Cusco (130 PEN)", sub:"Include Pisac, Moray, Ollantaytambo, Sacsayhuam√°n. Acquistabile a Cusco.", urgency:"green"},
      {text:"Ticket Canyon del Colca (70 PEN)", sub:"Include Chivay e Cruz del C√≥ndor. Si paga a Chivay.", urgency:"green"},
    ]
  },
  {
    icon:"üöå", title:"Tour & Escursioni", color:"#2D6A4F",
    items:[
      {text:"Tour Canyon del Colca ‚Äî Giardino Tours (31 Ago + 1 Set)", sub:"giardinotours.com ‚Äî 2 giorni, include colazione e pranzo.", urgency:"orange"},
      {text:"Tour Valle Sacra con drop-off Ollantaytambo (3 Set)", sub:"getyourguide.com ‚Äî Sacred Valley Cusco Ollantaytambo Transfer.", urgency:"orange"},
      {text:"Tour Rainbow Mountain (6 Set)", sub:"rainbowmountaintravels.com o getyourguide.com. Pickup 03:30.", urgency:"orange"},
      {text:"Tour Isole Ballestas a Paracas (29 Ago)", sub:"Si prenota in loco al porto. ~58 PEN.", urgency:"green"},
      {text:"Dune Buggy Huacachina (29 Ago pomeriggio)", sub:"Si prenota in loco. ~80 PEN. Tramonto!", urgency:"green"},
    ]
  },
  {
    icon:"üåø", title:"Lodge Amazzonia", color:"#1B4F72",
    items:[
      {text:"Lodge Tambopata 2 notti (7-9 Set)", sub:"Refugio Amazonas (rainforestexpeditions.com) o Sandoval Lake Lodge. Tutto incluso.", urgency:"red"},
      {text:"Verificare trasfer aeroporto incluso nel lodge", sub:"Il lodge solitamente gestisce barca e trasferimenti.", urgency:"orange"},
    ]
  },
  {
    icon:"üíä", title:"Salute & Documenti", color:"#E8A830",
    items:[
      {text:"Consulta medico per profilassi antimalarica", sub:"Zona Tambopata a basso rischio ma meglio verificare.", urgency:"orange"},
      {text:"Sorojchi Pills (mal di montagna)", sub:"Acquistabili anche in Per√π in farmacia. ~5 PEN.", urgency:"green"},
      {text:"Passaporto valido almeno 6 mesi", sub:"Il Per√π richiede 6 mesi di validit√† dalla data di ingresso.", urgency:"red"},
      {text:"Assicurazione viaggio con copertura alta quota", sub:"Include copertura a 5.200m per Rainbow Mountain.", urgency:"orange"},
    ]
  }
];

// ===== WIKIPEDIA IMAGE SYSTEM =====
// Titoli Wikipedia EN verificati. API: /api/rest_v1/page/summary/{title}
// restituisce thumbnail.source = URL diretto CDN Wikimedia (funziona come <img src>)

const WIKI_TITLES = {
  // Giorni (header grandi)
  "Miraflores_District,_Lima":     "Miraflores_District,_Lima",
  "Huacachina":                    "Huacachina",
  "Arequipa":                      "Arequipa",
  "Cruz_del_C√≥ndor":               "Cruz_del_C%C3%B3ndor",
  "Colca_Canyon":                  "Colca_Canyon",
  "Cusco":                         "Cusco",
  "Sacred_Valley":                 "Sacred_Valley",
  "Machu_Picchu":                  "Machu_Picchu",
  "Ollantaytambo":                 "Ollantaytambo",
  "Vinicunca":                     "Vinicunca",
  "Tambopata_National_Reserve":    "Tambopata_National_Reserve",
  "Scarlet_macaw":                 "Scarlet_macaw",
  "Giant_otter":                   "Giant_otter",
  "Madre_de_Dios_River":           "Madre_de_Dios_River",
  // Stops
  "Jorge_Ch√°vez_International_Airport": "Jorge_Ch%C3%A1vez_International_Airport",
  "Historic_Centre_of_Lima":       "Historic_Centre_of_Lima",
  "Convent_of_San_Francisco,_Lima":"Convent_of_San_Francisco,_Lima",
  "Peruvian_cuisine":              "Peruvian_cuisine",
  "Barranco_District":             "Barranco_District",
  "Lima":                          "Lima",
  "Paracas,_Ica":                  "Paracas,_Ica",
  "Ballestas_Islands":             "Islas_Ballestas",
  "Ica,_Peru":                     "Ica,_Peru",
  "Oasis":                         "Huacachina",
  "Rodr√≠guez_Ball√≥n_International_Airport": "Rodrigo_Bueno_International_Airport",
  "Historic_Centre_of_Arequipa":   "Historic_Centre_of_Arequipa",
  "Alpaca":                        "Alpaca",
  "Chivay":                        "Colca_Canyon",
  "Andean_condor":                  "Andean_condor",
  "Llama":                          "Llama",
  "Inca_architecture":              "Colca_Canyon",
  "El_Misti":                       "El_Misti",
  "Alejandro_Velasco_Astete_International_Airport": "Cusco",
  "Altitude_sickness":              "Altitude_sickness",
  "Mercado_de_San_Pedro,_Cusco":    "Cusco",
  "Qorikancha":                     "Qorikancha",
  "Plaza_de_Armas_(Cusco)":         "Plaza_de_Armas_(Cusco)",
  "Mate_de_coca":                   "Mate_de_coca",
  "Pisac":                          "Pisac",
  "Andean_textiles":                "Andean_textiles",
  "Salinas_de_Maras":               "Salinas_de_Maras",
  "Moray_(Inca_ruin)":              "Moray_(Inca_ruin)",
  "Urubamba_River":                 "Urubamba_River",
  "Aguas_Calientes,_Peru":          "Aguas_Calientes,_Peru",
  "PeruRail":                       "Sacred_Valley",
  "Huayna_Picchu":                  "Huayna_Picchu",
  "Intihuatana":                    "Machu_Picchu",
  "Inti_Punku":                     "Inti_Punku",
  "Hot_spring":                     "Aguas_Calientes,_Peru",
  "Sacsayhuam%C3%A1n":              "Sacsayhuam%C3%A1n",
  "Sacsayhuam√°n":                   "Sacsayhuam%C3%A1n",
  "Hiking":                         "Vinicunca",
  "Iron_oxide":                     "Vinicunca",
  "Quinoa":                         "Quinoa",
  "Andes":                          "Vinicunca",
  "Puerto_Maldonado":               "Puerto_Maldonado",
  "Amazon_rainforest":              "Amazon_rainforest",
  "Poison_dart_frog":               "Poison_dart_frog",
  "Caiman":                         "Caiman",
  "Hammock":                        "Tambopata_National_Reserve",
  "Emergent_layer":                 "Amazon_rainforest",
  "Amazon_river_dolphin":           "Amazon_river_dolphin",
  "Indigenous_peoples_of_the_Amazon": "Amazon_rainforest",
  "Piranha":                        "Piranha",
  "Birdwatching":                   "Scarlet_macaw",
};

let headerGeneration = 0;
const wikiCache = {};

async function getWikiImg(wikiKey, width) {
  const title = WIKI_TITLES[wikiKey] || wikiKey;
  const cacheKey = title + '_' + (width||400);
  if (wikiCache[cacheKey] !== undefined) return wikiCache[cacheKey];
  try {
    const r = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${title}`);
    if (!r.ok) { wikiCache[cacheKey] = null; return null; }
    const d = await r.json();
    let src = d.thumbnail?.source || d.originalimage?.source || null;
    if (src && width) src = src.replace(/\/\d+px-/, `/${width}px-`);
    wikiCache[cacheKey] = src;
    return src;
  } catch(e) { wikiCache[cacheKey] = null; return null; }
}

function setImgSrc(el, wikiKey, width) {
  getWikiImg(wikiKey, width).then(src => {
    if (!el.isConnected) return;
    if (src) {
      el.style.opacity = '0';
      el.onload = () => { el.style.transition = 'opacity .4s'; el.style.opacity = '1'; };
      el.src = src;
    } else {
      el.style.background = '#2a1f10';
    }
  });
}

// ===== STATE =====
let currentDay = 1;
let homeMap = null, dayMap = null;
let dayMapLayers = [];
let todoDoneState = {};

// ===== NAVIGATION =====
function showPage(page, dayId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

  if(page === 'home') {
    document.getElementById('home').classList.add('active');
    document.querySelector('.nav-btn:first-child').classList.add('active');
    setTimeout(initHomeMap, 100);
    buildJourneyGrid();
  } else if(page === 'day') {
    document.getElementById('day-page').classList.add('active');
    document.getElementById('day-nav-btn').classList.add('active');
    currentDay = dayId || currentDay;
    renderDay(currentDay);
  } else if(page === 'todo') {
    document.getElementById('todo-page').classList.add('active');
    document.querySelector('.nav-todo').classList.add('active');
    buildTodo();
  }
}

// ===== HOME =====
function buildJourneyGrid() {
  const grid = document.getElementById('journey-grid');
  if(grid.children.length > 0) return;
  DAYS.forEach(d => {
    const card = document.createElement('div');
    card.className = 'journey-card';
    const imgEl = document.createElement('img');
    imgEl.className = 'journey-card-img';
    imgEl.alt = d.title;
    imgEl.loading = 'lazy';
    imgEl.style.background = '#2a1f10';
    card.appendChild(imgEl);
    card.innerHTML += `
      <div class="journey-card-body">
        <div class="journey-card-day">Giorno ${d.id}</div>
        <div class="journey-card-title">${d.title}</div>
        <div class="journey-card-date">${d.fullDate}</div>
      </div>`;
    // Reinserisci img come primo figlio (innerHTML sovrascrive)
    card.prepend(imgEl);
    setImgSrc(imgEl, d.wiki, 400);
    card.onclick = () => showPage('day', d.id);
    grid.appendChild(card);
  });
}

function initHomeMap() {
  if(homeMap) return;
  homeMap = L.map('home-map', {zoomControl:true, scrollWheelZoom:false}).setView([-13.5, -73.5], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'¬© OpenStreetMap', maxZoom:18
  }).addTo(homeMap);

  // Percorso terrestre (oro tratteggiato)
  const routeLand = [
    [-12.046, -77.043],  // Lima
    [-13.840, -76.398],  // Paracas
    [-14.088, -75.957],  // Huacachina
    [-16.409, -71.537],  // Arequipa
    [-15.630, -71.950],  // Colca
    [-13.517, -71.978],  // Cusco
    [-13.418, -71.851],  // Valle Sacra
    [-13.257, -72.264],  // Ollantaytambo
    [-13.153, -72.525],  // Machu Picchu
    [-13.257, -72.264],  // Ollantaytambo (ritorno)
    [-13.517, -71.978],  // Cusco
    [-13.870, -71.303],  // Rainbow Mountain
    [-13.517, -71.978],  // Cusco (rientro)
  ];
  L.polyline(routeLand, {color:'#E8A830', weight:2.5, opacity:.85, dashArray:'6,4'}).addTo(homeMap);

  // Tratte aeree (rosso, pi√π tratteggiate)
  const flights = [
    [[-12.022, -77.114], [-16.341, -71.572]],  // Lima ‚Üí Arequipa
    [[-16.341, -71.572], [-13.535, -71.939]],  // Arequipa ‚Üí Cusco
    [[-13.535, -71.939], [-12.614, -69.229]],  // Cusco ‚Üí Puerto Maldonado
    [[-12.614, -69.229], [-12.022, -77.114]],  // Puerto Maldonado ‚Üí Lima ‚úàÔ∏è
  ];
  flights.forEach(([a,b]) => {
    L.polyline([a,b], {color:'#C4501A', weight:1.8, opacity:.75, dashArray:'3,7'}).addTo(homeMap);
  });

  const locations = [
    {n:1,  name:"Lima",                    lat:-12.046, lng:-77.043, day:1},
    {n:2,  name:"Paracas & Huacachina",    lat:-14.088, lng:-75.957, day:2},
    {n:3,  name:"Arequipa",               lat:-16.409, lng:-71.537, day:3},
    {n:4,  name:"Canyon del Colca",        lat:-15.630, lng:-71.950, day:4},
    {n:5,  name:"Cusco",                  lat:-13.517, lng:-71.978, day:6},
    {n:6,  name:"Valle Sacra",            lat:-13.350, lng:-72.000, day:7},
    {n:7,  name:"Machu Picchu",           lat:-13.163, lng:-72.545, day:8},
    {n:8,  name:"Rainbow Mountain",       lat:-13.870, lng:-71.303, day:10},
    {n:9,  name:"Amazzonia (Tambopata)",  lat:-12.593, lng:-69.189, day:11},
  ];

  locations.forEach(loc => {
    const icon = L.divIcon({
      className:'',
      html:`<div style="
        background:${loc.n===1?'#C4501A':'#E8A830'};
        border:2px solid #1A1208;
        width:28px; height:28px; border-radius:50%;
        display:flex; align-items:center; justify-content:center;
        font-family:'Barlow Condensed',sans-serif;
        font-size:12px; font-weight:700; color:#1A1208;
        box-shadow:0 2px 10px rgba(0,0,0,0.6);
        cursor:pointer;
      ">${loc.n}</div>`,
      iconSize:[28,28], iconAnchor:[14,14]
    });
    const marker = L.marker([loc.lat, loc.lng], {icon}).addTo(homeMap);
    marker.bindPopup(`<b style="color:#E8A830">Tappa ${loc.n}</b><br>${loc.name}`);
    marker.on('click', () => showPage('day', loc.day));
  });

  // Legenda
  const legend = L.control({position:'bottomleft'});
  legend.onAdd = () => {
    const d = L.DomUtil.create('div');
    d.style.cssText = 'background:rgba(26,18,8,.92);border:1px solid rgba(232,168,48,.3);border-radius:6px;padding:.5rem .8rem;font-family:Barlow,sans-serif;font-size:.72rem;color:rgba(255,255,255,.7);line-height:1.6';
    d.innerHTML = '<div>‚îÄ‚îÄ Terrestre</div><div style="color:#C4501A">‚ïå Volo ‚úàÔ∏è</div>';
    return d;
  };
  legend.addTo(homeMap);
}

// ===== DAY PAGE =====
function buildDayPills() {
  const container = document.getElementById('day-pills');
  container.innerHTML = '';
  DAYS.forEach(d => {
    const pill = document.createElement('button');
    pill.className = 'day-pill' + (d.id === currentDay ? ' active' : '');
    pill.textContent = `G${d.id} ¬∑ ${d.title}`;
    pill.onclick = () => { currentDay = d.id; renderDay(d.id); };
    container.appendChild(pill);
  });
  // Scroll active pill into view
  setTimeout(() => {
    const active = container.querySelector('.active');
    if(active) active.scrollIntoView({block:'nearest', inline:'center', behavior:'smooth'});
  }, 50);
}

function renderDay(id) {
  const d = DAYS.find(x => x.id === id);
  if(!d) return;
  currentDay = id;

  // Header con anti-race-condition
  const bgEl = document.getElementById('day-header-bg');
  const myGen = ++headerGeneration;
  bgEl.style.backgroundImage = '';
  bgEl.style.background = 'linear-gradient(135deg, #1a2e12 0%, #2d1b0e 100%)';
  getWikiImg(d.wiki, 1200).then(src => {
    if (src && headerGeneration === myGen) bgEl.style.backgroundImage = `url('${src}')`;
  });
  document.getElementById('day-number-label').textContent = `Giorno ${d.id} di 14`;
  document.getElementById('day-title').textContent = d.title;
  document.getElementById('day-date-str').textContent = d.fullDate + ' ¬∑ ' + d.subtitle;

  // Pills
  buildDayPills();

  // Arrows
  document.getElementById('prev-btn').disabled = id <= 1;
  document.getElementById('next-btn').disabled = id >= DAYS.length;

  // Info box
  const infoBox = document.getElementById('day-info-box');
  infoBox.innerHTML = d.info.map(i => `
    <div class="info-item">
      <div class="info-label">${i.label}</div>
      <div class="info-value">${i.value}</div>
    </div>`).join('');

  // Stops
  const stopsContainer = document.getElementById('stops-container');
  stopsContainer.innerHTML = d.stops.map((s, i) => `
    <div class="stop-card">
      <img class="stop-img" id="stop-img-${i}" alt="${s.name}" style="background:#1a1208">
      <div class="stop-body">
        <div class="stop-time">${s.time}</div>
        <div class="stop-name">${s.name}</div>
        <div class="stop-desc">${s.desc}</div>
      </div>
    </div>`).join('');
  // Carica immagini in parallelo
  d.stops.forEach((s, i) => {
    const el = document.getElementById(`stop-img-${i}`);
    if(el) setImgSrc(el, s.wiki, 200);
  });

  // Tips
  const tipsBox = document.getElementById('tips-box');
  tipsBox.innerHTML = `<div class="tips-title">üí° Consigli pratici</div>` +
    d.tips.map(t => `<div class="tip-item">${t}</div>`).join('');

  // Map
  renderDayMap(d);
}

function renderDayMap(d) {
  if(dayMap) { dayMap.remove(); dayMap = null; }

  dayMap = L.map('day-map', {zoomControl:true, scrollWheelZoom:false});
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'¬© OpenStreetMap', maxZoom:18
  }).addTo(dayMap);

  // Separa le tappe locali (da zoomare) dai transfer
  const localStops = d.stops.filter(s => !s.transfer);
  const allStops   = d.stops;

  // Polyline solo tra le tappe locali
  if(localStops.length > 1) {
    const coords = localStops.map(s => [s.lat, s.lng]);
    L.polyline(coords, {color:'#E8A830', weight:2.5, opacity:0.85, dashArray:'5,4'}).addTo(dayMap);
  }

  // Numerazione progressiva solo tra le stop locali
  let localIdx = 0;
  allStops.forEach((s, i) => {
    const isTransfer = !!s.transfer;
    const num = isTransfer ? null : ++localIdx;

    const size = isTransfer ? 10 : 26;
    const html = isTransfer
      ? `<div style="
            background:#555; border:2px solid #1A1208;
            width:10px; height:10px; border-radius:50%;
            opacity:0.5;
          "></div>`
      : `<div style="
            background:${num===1?'#C4501A':'#E8A830'};
            border:2px solid #1A1208;
            width:26px; height:26px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            font-family:'Barlow Condensed',sans-serif;
            font-size:11px; font-weight:700; color:#1A1208;
            box-shadow:0 2px 8px rgba(0,0,0,0.5);
          ">${num}</div>`;

    const icon = L.divIcon({
      className:'', html,
      iconSize:[size,size], iconAnchor:[size/2,size/2]
    });

    L.marker([s.lat, s.lng], {icon}).addTo(dayMap)
      .bindPopup(`<b style="color:#E8A830">${s.time}</b><br>${s.name}`);
  });

  // Zoom automatico sui punti locali con padding
  if(localStops.length > 0) {
    const bounds = L.latLngBounds(localStops.map(s => [s.lat, s.lng]));
    if(localStops.length === 1) {
      dayMap.setView([localStops[0].lat, localStops[0].lng], 14);
    } else {
      dayMap.fitBounds(bounds, {padding:[40,40], maxZoom:15});
    }
  }
}

function navigateDay(delta) {
  const newId = currentDay + delta;
  if(newId >= 1 && newId <= DAYS.length) {
    currentDay = newId;
    renderDay(newId);
    window.scrollTo({top: document.querySelector('.day-nav-bar').offsetTop - 60, behavior:'smooth'});
  }
}

// ===== TODO =====
function buildTodo() {
  const grid = document.getElementById('todo-grid');
  if(grid.children.length > 0) { updateProgress(); return; }

  TODO_CATS.forEach((cat, ci) => {
    const div = document.createElement('div');
    div.className = 'todo-category';
    div.innerHTML = `
      <div class="todo-cat-header" style="background:${cat.color}22;border-bottom:1px solid ${cat.color}44">
        <div class="todo-cat-icon">${cat.icon}</div>
        <div class="todo-cat-title" style="color:${cat.color}">${cat.title}</div>
      </div>
      <div class="todo-items">
        ${cat.items.map((item, ii) => {
          const key = `${ci}-${ii}`;
          const done = todoDoneState[key];
          return `<div class="todo-item ${done?'done':''}" onclick="toggleTodo('${key}', this)">
            <div class="todo-check"></div>
            <div class="todo-item-content">
              <div class="todo-item-main">${item.text}</div>
              <div class="todo-item-sub">${item.sub}</div>
            </div>
            <div class="todo-urgency urgency-${item.urgency}">${item.urgency==='red'?'Urgente':item.urgency==='orange'?'Presto':'Consigliato'}</div>
          </div>`;
        }).join('')}
      </div>`;
    grid.appendChild(div);
  });
  updateProgress();
}

function toggleTodo(key, el) {
  todoDoneState[key] = !todoDoneState[key];
  el.classList.toggle('done');
  updateProgress();
}

function updateProgress() {
  const total = TODO_CATS.reduce((s,c) => s + c.items.length, 0);
  const done = Object.values(todoDoneState).filter(Boolean).length;
  const pct = total > 0 ? Math.round(done/total*100) : 0;
  document.getElementById('progress-bar').style.width = pct + '%';
  document.getElementById('progress-text').textContent = `${done} / ${total} completati (${pct}%)`;
}

// ===== INIT =====
window.addEventListener('load', () => {
  initHomeMap();
  buildJourneyGrid();
  getWikiImg('Machu_Picchu', 1600).then(src => {
    if (src) document.querySelector('.hero-bg').style.backgroundImage = `url('${src}')`;
  });
});
</script>
</body>
</html>
